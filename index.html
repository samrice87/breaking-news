<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breaking News Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div id="root" class="min-h-screen p-4"></div>
    
    <audio id="alert-sound" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUKXh8LdnHwU2jdXzzn0vBSF1xe/glEILElyx6OyrWBUIQ5zd8sFuJAUrhM/y2Ik2CBxqvfDknE4MDlCl4fC3Zx8FNo3V8859LwUhdcXv4JRCC"></audio>

    <script>
        // State
        let articles = [];
        let seenIds = new Set();
        let lastUpdate = null;
        let isLoading = false;
        let newCount = 0;

        // Feeds configuration
        const feeds = [
            { url: 'https://nitter.net/AP/rss', name: 'AP News', priority: 'high' },
            { url: 'https://nitter.net/Reuters/rss', name: 'Reuters', priority: 'high' },
            { url: 'https://nitter.net/CNN/rss', name: 'CNN', priority: 'medium' },
            { url: 'https://nitter.net/CNNPolitics/rss', name: 'CNN Politics', priority: 'high' },
            { url: 'https://nitter.net/FoxNews/rss', name: 'Fox News', priority: 'medium' },
            { url: 'https://nitter.net/NBCNews/rss', name: 'NBC News', priority: 'medium' },
            { url: 'https://nitter.net/Breaking911/rss', name: 'Breaking911', priority: 'high' },
            { url: 'https://nitter.net/BNONews/rss', name: 'BNO News', priority: 'high' },
        ];

        // Utility functions
        function formatTime(date) {
            const now = new Date();
            const diff = Math.floor((now - date) / 1000);
            
            if (diff < 60) return 'Just now';
            if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
            return date.toLocaleTimeString();
        }

        function getPriorityColor(priority) {
            if (priority === 'high') return 'border-l-red-500';
            if (priority === 'medium') return 'border-l-orange-500';
            return 'border-l-blue-500';
        }

        // Fetch feeds
        async function fetchFeeds() {
            isLoading = true;
            render();
            
            const newArticles = [];
            let hasNewItems = false;

            for (const feed of feeds) {
                try {
                    const response = await fetch(feed.url);
                    const text = await response.text();
                    const parser = new DOMParser();
                    const xml = parser.parseFromString(text, 'text/xml');
                    const items = xml.querySelectorAll('item');

                    items.forEach((item, index) => {
                        if (index < 5) {
                            const title = item.querySelector('title')?.textContent || '';
                            const link = item.querySelector('link')?.textContent || '';
                            const pubDate = item.querySelector('pubDate')?.textContent || '';
                            const id = `${feed.name}-${title}`;

                            const isBreaking = title.toLowerCase().includes('breaking') || 
                                             title.toLowerCase().includes('urgent') ||
                                             title.includes('ðŸš¨');

                            const article = {
                                id,
                                title,
                                link,
                                source: feed.name,
                                time: new Date(pubDate),
                                isNew: !seenIds.has(id),
                                isBreaking,
                                priority: feed.priority
                            };

                            if (!seenIds.has(id)) {
                                hasNewItems = true;
                                seenIds.add(id);
                            }

                            newArticles.push(article);
                        }
                    });
                } catch (error) {
                    console.error(`Error fetching ${feed.name}:`, error);
                }
            }

            newArticles.sort((a, b) => b.time - a.time);
            articles = newArticles;
            lastUpdate = new Date();
            isLoading = false;

            if (hasNewItems && seenIds.size > 5) {
                newCount = newArticles.filter(a => a.isNew).length;
                const audio = document.getElementById('alert-sound');
                if (audio) {
                    audio.play().catch(e => console.log('Audio play failed:', e));
                }
                setTimeout(() => {
                    newCount = 0;
                    render();
                }, 3000);
            }

            render();
        }

        // Render UI
        function render() {
            const root = document.getElementById('root');
            
            const html = `
                <div class="max-w-4xl mx-auto mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-blue-400">
                                <path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"/>
                            </svg>
                            <h1 class="text-2xl font-bold">Breaking News Monitor</h1>
                        </div>
                        <button onclick="fetchFeeds()" ${isLoading ? 'disabled' : ''} class="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg disabled:opacity-50">
                            <svg class="${isLoading ? 'animate-spin' : ''}" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"/>
                                <polyline points="1 20 1 14 7 14"/>
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                            </svg>
                            Refresh
                        </button>
                    </div>

                    <div class="flex items-center justify-between text-sm bg-gray-800 p-3 rounded-lg">
                        <div class="flex items-center gap-2">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-400">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            <span class="text-gray-400">
                                Last update: ${lastUpdate ? formatTime(lastUpdate) : 'Loading...'}
                            </span>
                        </div>
                        ${newCount > 0 ? `
                            <div class="flex items-center gap-2 bg-red-600 px-3 py-1 rounded-full animate-pulse">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                                    <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                                </svg>
                                <span class="font-bold">${newCount} New</span>
                            </div>
                        ` : ''}
                    </div>
                </div>

                <div class="max-w-4xl mx-auto space-y-3">
                    ${articles.length === 0 ? `
                        <div class="text-center py-12 text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-4 animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"/>
                                <polyline points="1 20 1 14 7 14"/>
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                            </svg>
                            <p>Loading breaking news...</p>
                        </div>
                    ` : articles.map(article => `
                        <div class="bg-gray-800 border-l-4 ${getPriorityColor(article.priority)} p-4 rounded-lg transition-all ${article.isNew ? 'ring-2 ring-blue-500 animate-pulse' : ''}">
                            <div class="flex items-start justify-between gap-3">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-2 flex-wrap">
                                        <span class="text-xs font-bold text-blue-400">${article.source}</span>
                                        <span class="text-xs text-gray-500">â€¢</span>
                                        <span class="text-xs text-gray-400">${formatTime(article.time)}</span>
                                        ${article.isNew ? '<span class="text-xs bg-red-600 px-2 py-0.5 rounded-full font-bold">NEW</span>' : ''}
                                        ${article.isBreaking ? '<span class="text-xs bg-yellow-600 px-2 py-0.5 rounded-full font-bold">ðŸš¨ BREAKING</span>' : ''}
                                    </div>
                                    <h3 class="text-base font-medium leading-tight mb-2">${article.title}</h3>
                                </div>
                                <a href="${article.link}" target="_blank" rel="noopener noreferrer" class="flex-shrink-0 text-blue-400 hover:text-blue-300">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                                        <polyline points="15 3 21 3 21 9"/>
                                        <line x1="10" y1="14" x2="21" y2="3"/>
                                    </svg>
                                </a>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <div class="max-w-4xl mx-auto mt-8 p-4 bg-gray-800 rounded-lg text-sm text-gray-400">
                    <p class="font-bold text-white mb-2">ðŸ“± Add to Home Screen:</p>
                    <p class="mb-2">iPhone: Tap Share â†’ Add to Home Screen</p>
                    <p>Android: Tap Menu (â‹®) â†’ Add to Home screen</p>
                    <p class="mt-3 text-xs">Checks every 60 seconds. Keep browser tab open for alerts.</p>
                </div>
            `;
            
            root.innerHTML = html;
        }

        // Initialize
        fetchFeeds();
        setInterval(fetchFeeds, 60000);
    </script>
</body>
</html>
